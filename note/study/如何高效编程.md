
*author:曲利斌*

# 如何高效编程

- 目标
> - 如何编写可读性 可维护性 健壮性 容错性都良好的代码呢？

> -如何在处理编程中的需求优化？



---

- 1.列表出项目中的优化列表。因为没人提醒，你一定会忘记的。
- 2.单元测试用例。帮助你提升代码理解，健壮，抽象性。
- 3.service层最好不要调用其他service，要保证一个service有自己的业务。如果有公用的逻辑，可以抽象出serviceHelper类，或者再抽象一层provider或者consumer.
- 4.获取数据一定要实时，并从源头获取。
- 5.事务中不应该出现RPC调用，HTTP调用，循环查询，消息队列等操作，最好事务只处理数据库操作。
- 6.监控大事务，1秒以上即为大事务。
- 7.事务尽量控制小，所以不建议切面配置事务，可以显式注解配置事务 或者直接代码粒度控制事务。
- 8.设置超时时间 = 该接口99%超时时间 在基础上加50%。
- 9. 依赖外部的地方必须考虑自动熔断。Netflix。手动熔断：监控关闭
- 10. 对于依赖我们的上游要限流。限流前根据业务压测 分析得出一个相对合理的最大QPS，Netflix 限流
- 11. 慢查询阈值 = 100ms 索引：核心交易索引一般不超过4个，如果不行就是表结构问题。
- 12:第一，“知其然不知其所以然”。做了多年技术，开发了很多业务应用，但似乎并未思考过种种 技术选择背后的逻辑。所以，我并不放心把具有一定深度的任务交给他。更重要的是，我并不确定他未来技术能力的成长潜力有多大。
第二，知识碎片化，不成系统。在面试中，面试者似乎无法完整、清晰地描述自己所开发的系统，或者使用的相关技术。所以，我会怀疑他是否具备高效解决复杂问题、设计复杂系统的能力。

- 算法逻辑没问题，就是数据有问题。

诸如此类问题还有很多，我这里分享一下个人的经验，其实就是3个词：learning、trying、teaching！

1）Learning
这个是第一阶段，看书、google、看视频、看别人的博客都可以，但要注意一点是“系统化”，特别是一些基础性的东西，例如JVM原理、Java编程、网络编程，HTTP协议等等，这些基础技术不能只通过google或者博客学习，我的做法一般是先完整的看完一本书全面的了解，然后再通过google、视频、博客去有针对性的查找一些有疑问的地方，或者一些技巧。

2）Trying
这个步骤就是解答前面提到的很多同学的疑惑的关键点，形象来说就是“自己动手丰衣足食”，也就是自己去尝试搭建一些模拟环境，自己写一些测试程序。例如：

Jvm垃圾回收：可以自己写一个简单的测试程序，分配内存不释放，然后调整各种jvm启动参数，再运行的过程中使用jstack、jstat等命令查看jvm的堆内存分布和垃圾回收情况。这样的程序写起来很简单，简单一点的就几行，复杂一点的也就几十行。
Reactor原理：自己真正去尝试写一个Reactor模式的Demo，不要以为这个很难，最简单的Reactor模式代码量（包括注释）不超过200行（可以参考Doug Lee的PPT）。自己写完后，再去看看netty怎么做，一对比理解就更加深刻了。
MySQL：既然有线上的配置可以参考，那可以直接让DBA将线上配置发给我们（注意去掉敏感信息），直接学习；然后自己搭建一个MySQL环境，用线上的配置启动；要知道很多同学用了很多年MySQL，但是连个简单的MySQL环境都搭不起来。
框架封装了DAL层：可以自己用JDBC尝试去写一个分库分表的简单实现，然后与框架的实现进行对比，看看差异在哪里。
用浏览器的工具查看HTTP缓存实现，看看不同种类的网站，不同类型的资源，具体是如何控制缓存的；也可以自己用Python写一个简单的HTTP服务器，模拟返回各种HTTP Headers来观察浏览器的反应。

还有很多方法，这里就不一一列举，简单来说，就是要将学到的东西真正试试，才能理解更加深刻，印第安人有一句谚语：I hear and I forget. I see and I remember. I do and I understand ，而且“试试”其实可以比较简单，很多时候我们都可以自己动手做。 

当然，如果能够在实际工作中使用，效果会更好，毕竟实际的线上环境和业务复杂度不是我们写个模拟程序就能够模拟的，但这样的机会可遇不可求，大部分情况我们还真的只能靠自己模拟，然后等到真正业务要用的时候，能够信手拈来。

3）Teaching
一般来说，经过Learning和Trying，能掌握70%左右，但要真正掌握，我觉得一定要做到能够跟别人讲清楚。因为在讲的时候，我们既需要将一个知识点系统化，也需要考虑各种细节，这会促使我们进一步思考和学习。同时，讲出来后看或者听的人可以有不同的理解，或者有新的补充，这相当于继续完善了整个知识技能体系。 

这样的例子很多，包括我自己写博客的时候经常遇到，本来我觉得自己已经掌握很全面了，但一写就发现很多点没考虑到；组内培训的时候也经常看到，有的同学写了PPT，但是讲的时候，大家一问，或者一讨论，就会发现很多点还没有讲清楚，或者有的点其实是理解错了。写PPT、讲PPT、讨论PPT，这个流程全部走一遍，基本上对一个知识点掌握就比较全面了


